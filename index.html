<!DOCTYPE html>
<html>
    <head>
        <title>Chat with OpenAI</title>
        <style>
            #chat {
                height: 400px;
                border: 1px solid black;
                padding: 10px;
                overflow: auto;
            }
            #input-area {
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <div id="chat"></div>
        <div id="input-area">
            <input id="input" type="text" />
            <button id="send">Send</button>
            <button id="clear">Clear Log</button>
        </div>

        <script>
            const chat = document.getElementById('chat');
            const input = document.getElementById('input');
            const sendButton = document.getElementById('send');
            const clearButton = document.getElementById('clear');
            const chatLog = JSON.parse(localStorage.getItem('chatLog')) || [];

            function appendMessage(content, role, saveMessage) {
                const messageElement = document.createElement('p');
                messageElement.textContent = `${role === 'user' ? 'You' : 'AI'}: ${content}`;
                chat.appendChild(messageElement);
                chat.scrollTop = chat.scrollHeight;

                if (saveMessage) {
                    // Save the message in the chat log and update localStorage
                    chatLog.push({ role, content });

                    if (chatLog.length > 10) {
                        chatLog.shift();
                    }

                    localStorage.setItem('chatLog', JSON.stringify(chatLog));
                }
            }

            // Load the previous chat log from localStorage
            chatLog.forEach(({ content, role }) => {
                appendMessage(content, role, false);
            });

            sendButton.addEventListener('click', () => {
                const message = input.value;
                input.value = '';
                appendMessage(message, 'user', true);

                fetch('https://baby-name-reveal-e392f1eb024a.herokuapp.com/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        conversations: chatLog
                    }),
                })
                .then((response) => response.json())
                .then((data) => {
                    const aiMessage = data.choices[0].message.content;
                    appendMessage(aiMessage, 'assistant', true);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });

            clearButton.addEventListener('click', () => {
                // Clear the chat log in localStorage and the chat display
                localStorage.removeItem('chatLog');
                chat.innerHTML = '';
            });
        </script>
    </body>
</html>

